# **常见蜜罐体验和探索**

## **一、实验目的**

- 了解蜜罐的分类和基本原理
- 了解不同类型蜜罐的适用场合
- 掌握常见蜜罐的搭建和使用

## **二、实验环境**

- 低交互蜜罐
  - ssh_honeypot蜜罐
- 中交互蜜罐
  - cowrie蜜罐
- 两台kali和一台Debian-Getway
  - kali-victim1作为防御者，搭建蜜罐
  - kali-attacker作为攻击者
  - Debian-Getway作为内网网关
- 拓扑结构：victim——>Getway<——attacker

## **三、实验原理**

- 蜜罐用以监视、检测和分析攻击。
- 蜜罐三大主要功能：捕获数据。避免被识别。防止被攻陷。
- 低交互蜜罐
  - 只会让攻击者非常有限地访问操作系统。“低交互”意味着，对手无法在任何深度上与诱饵系统进行交互，因为它是一个更加静态的环境。低交互蜜罐通常会模仿少量的互联网协议和网络服务，足以欺骗攻击者。
  - 低交互蜜罐易于部署，不允许访问真正的root shell，也不使用大量资源进行维护。
- 中交互蜜罐
  - 是对真正的操作系统的各种行为的模拟，它提供了更多的交互信息，同时也可以从攻击者的行为中获得更多的信息。在这个模拟行为的系统中，蜜罐可以看起来和一个真正的操作系统没有区别。

## **四、实验过程**

### (一) 蜜罐的搭建

1. 低交互蜜罐——ssh_honeypot
    - git clone <https://github.com/droberson/ssh-honeypot.git>  
    安装ssh_honeypot蜜罐
    - vi /etc/ssh/sshd_config  
    设置蜜罐的端口为不常用的端口，如56
    ![ ](image\ssh-honeypot安装配置.JPG)
    - service ssh restart
    - service docker start  
    启动ssh、docker服务，为搭建蜜罐的配置做准备
    - libssh包和libjson-c包作为环境，需要安装
        - apt install libssh-dev libjson-c-dev
    - 进入ssh_honeypot文件夹，做蜜罐基本设置并启动蜜罐
        - cd ssh-honeypot
        - ssh-keygen -t rsa -f ./ssh-honeypot.rsa
        - make
        - bin/ssh-honeypot -r ./ssh-honeypot.rsa
    - 搭建完成
    ![ ](image\ssh-honeypot安装完毕.JPG)

2. 中交互蜜罐——cowrie
    - git clone <https://github.com/cowrie/cowrie.git>  
    下载安装cowrie蜜罐
    - docker pull cowrie/cowrie  
    安装镜像
    - docker run -p 2222:2222 cowrie/cowrie  
    开启cowrie蜜罐
    ![ ](image\cowrie启动.JPG)

### (二)nmap扫描、ssh连接与蜜罐

1. 低交互蜜罐
    - nmap扫描
        - nmap -sT -P 22 -T4 -n -vv 172.16.111.144(TCP connect)
        - nmap -sS -P 22 -T4 -n -vv 172.16.111.144(半开扫描)
        - nmap -sX -P 22 -T4 -n -vv 172.16.111.144(Xmas扫描)
        - nmap -sF -P 22 -T4 -n -vv 172.16.111.144(Fin扫描)
        - 没有记录
        ![ ](image\ssh-honeypot日志.JPG)
    - ssh连接
        - ssh root@172.16.111.144 -p 22  
        可以观察到无法连接
        ![ ](image\ssh-honeypot日志.JPG)
            - 蜜罐的监控情况
            ![ ](image\cowrie的ssh攻击者ping.JPG)
        - ping www.baidu.com
        ![ ](image\cowrie的ssh的连接.JPG)
            - ![ ](image\cowrie的ssh的ping监控.JPG)
2. 中交互蜜罐——cowrie
    - nmap扫描
        - nmap -sT -P 22 -T4 -n -vv 172.16.111.144(TCP connect)
        - nmap -sS -P 22 -T4 -n -vv 172.16.111.144(半开扫描)
        - nmap -sX -P 22 -T4 -n -vv 172.16.111.144(Xmas扫描)
        - nmap -sF -P 22 -T4 -n -vv 172.16.111.144(Fin扫描)
        - 由图，仅在connect扫描时有记录
        ![ ](image\cowrie-nmap扫描.JPG)
    - ssh连接
        - ssh root@172.16.111.144 -p 2222
        ![ ](image\cowrie的ssh的连接.JPG)
            - 蜜罐的监控情况
            ![ ](image\cowrie的ssh攻击者ping.JPG)
        - ping www.baidu.com
        ![ ](image\cowrie的ssh的连接.JPG)
            - ![ ](image\cowrie的ssh的ping监控.JPG)

## **五、实验问题**

- attacker连接ssh时报错IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
  - 删除.ssh目录下的known_hosts文件  
  rm -rf ~/.ssh/known_hosts
